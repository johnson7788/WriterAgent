# Langgraph ART 训练模型, 单Agent结构

## 搜索输出
WebSearchClient = ZhipuAiClient(api_key="your-api-key")
response = WebSearchClient.web_search.web_search(
        search_engine="search_std",
        search_query="搜索2025年4月的财经新闻",
        count=15,  # 返回结果的条数，范围1-50，默认10
        search_recency_filter="noLimit",  # 搜索指定日期范围内的内容
        content_size="high"  # 控制网页摘要的字数，默认medium
    )
 [
    {
      "title": "【专题报告】股指主题会议纪要",
      "link": "",
      "content": "正文共4948字，阅读时间约10分钟 观点概述： 4月以来，股市走出慢牛”行情，大盘托底反内卷”驱动小盘轮动，带动上证屡创新高。本轮牛市是否可持续，还有多少上涨空间，节奏上如何把握，各品种间又有哪些投资机会，是我们本次股指会议研讨的重点。 2025年4月大跌后，国家队”救市为大盘托底，但前期市场仍聚集在EPS存在改善预期的行业和中证1000等小盘股，指数并未出现明显抬升，7月，美国经济数据走弱，海外降息空间打开；中央财经委员会强调反内卷”， 引发供给侧改革2.0遐想；股市财富效应显现，流动性向股市转移，水牛”出现，指数突破上涨。但国内数据显示经济动能开始走弱，与股市持续上涨形成背离，在居民存款搬家和风险偏好抬升”外，是否还有其他关键因素引导了此次上涨，我们是否处在某个周期性的拐点？ 此次会议后，我们认为空间上，长期还有上涨空间，从水牛”转向盈利牛”是主要方向；节奏上短期未见顶，但上行趋势中指数有波动可能；品种推荐从中证1000转向沪深300和中证500，以垄断性龙头和周期性板块EPS修复为主线。 具体品种： 沪深300。具备全球定价权或高集中度龙头，估值仍处低位，戴维斯双击空间最大；国家队持续托底，融资盘/减持均处低位，供给收缩分红提升带来紧平衡”；海外流动性被动扩张（美债利率高位回落、美元下行），外资回流首选大盘蓝筹。 中证500。周期板块EPS扩张型特征明确，地产链利润下滑已计价，成本端地价见顶回落带来毛利修复；财政扩张若转向有效投资，周期品需求弹性最大，有色、化工等龙头集中在中证500；贴水尚未极致，量化与雪球资金持续增配，收益估值修复双击。 风险：政府加税和地产超预期走弱是需要关注的风险，海外环境也需要持续跟踪，尚不做预测。 一国内外宏观情况分享 1、当前海外宏观环境 货币政策环境，汇率市场波动，基本面和地缘（关税）是4-7月中美股市共振的主要因素。 货币政策方面，中美同步交易降息预期。美国近期经济硬数据有波动，但长期看美国政策端对货币环境引导加强，美联储理事任命受政治影响，鹰派声音减弱，大概率降息；且美国流动性工具储备情况及财政税收季需求，将倒逼美联储采取行动。 汇率市场方面，美元指数年初至今整体走弱，人民币被动企稳。美元指数虽 7 月有小反弹，但长期向下趋势不变。美欧、美日利差缩小，资金回流美国动力不足，且美国债务问题将持续施压美元指数，美元美债背离将可能持续。 基本面方面，中美股市主线均集中于盈利改善的互联网金融，",
      "icon": "",
      "media": "",
      "refer": "ref_1",
      "publish_date": "2025-08-25"
    }
 ]

## 训练
export CUDA_VISIBLE_DEVICES=1
export HF_ENDPOINT=https://hf-mirror.com
python train.py

## 测试
python model_test.py

## kill，卡住的时候
ps aux | grep train.py | grep -v grep | awk '{print $2}' | xargs kill -9


## wandb日志
http://192.168.100.8:3005/johnson/web-search-agent-training


# 1) 格式奖励（format_reward，0~1）

衡量输出是否严格保持原大纲结构并充分填充 text：

结构一致性（0.40）：task 的数组长度、各元素 type 一致；cover/transition 的 data.title 不变；content 的 data.title 与 items 长度、每个 item.title 不变；

填充完整度（0.30）：所有 text 不再是默认“Detailed content…”或空；长度≥120字；

引用标注覆盖（0.20）：≥80% 的 text 含至少一个 [n] 引用（对应 sources 中的 URL 编号）；

JSON 合法性（0.10）：能被严格反序列化为与输入等价的 schema。

# 2) 搜索内容奖励（search_reward，0~1）

衡量信息扎实可核验与搜索质量：

来源数量与多样性（0.35）：sources 中有效 URL 数量（去重）与域名多样性评分；

证据化/具体化（0.35）：含数字/百分比/时间点等“可核验特征”的 text 占比；

引用一致性（0.20）：text 中引用的 [n] 均能在 sources[n-1] 找到，且 URL 合法；

新近性启发（0.10）：如 text 含 2023/2024/2025 等显式年份或“Q1/Q2”等时间线信号（启发式）。
